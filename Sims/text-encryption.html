<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Message Cipher</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; color: #334e68; }
.output-textarea { cursor: text; user-select: all; }
.notification {
    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
    padding: 1rem 2rem; border-radius: 9999px;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);
    opacity: 0; transition: opacity 0.5s ease-in-out; z-index: 1000;
    text-align: center;
}
.notification-show { opacity: 1; }
.notification-error { background-color: #fca5a5; color: #b91c1c; }
</style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

<div id="notification" class="notification"></div>

<div class="bg-white p-8 md:p-12 rounded-3xl shadow-xl w-full max-w-3xl transition-all duration-500 transform hover:scale-105 my-8">
    <h1 class="text-4xl font-extrabold text-blue-500 mb-2 text-center drop-shadow-md">Message Cipher</h1>
    <p class="text-sm text-gray-500 mb-8 text-center">Encrypt or decrypt messages.</p>

    <div class="space-y-8">
        <!-- Encryption -->
        <div class="bg-gray-50 p-6 rounded-2xl shadow-inner border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">Encrypt</h2>
            <label class="block text-sm font-medium text-gray-700">Plaintext:</label>
            <textarea id="plaintext" rows="4" class="mt-1 block w-full rounded-lg border-2 border-gray-300 shadow-sm p-3 bg-white text-gray-800"></textarea>
            
            <div class="grid grid-cols-2 gap-4 mt-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">k:</label>
                    <input type="number" id="k_encrypt" class="mt-1 block w-full rounded-lg border-2 border-gray-300 shadow-sm p-3 bg-white text-gray-800">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">r:</label>
                    <input type="number" id="r_encrypt" class="mt-1 block w-full rounded-lg border-2 border-gray-300 shadow-sm p-3 bg-white text-gray-800">
                </div>
            </div>
            <button id="encryptBtn" onclick="encryptText()" class="w-full mt-6 py-3 px-4 rounded-lg shadow-lg text-sm font-bold text-white bg-blue-500 hover:bg-blue-600 transition-colors duration-200">Encrypt</button>
            
            <div class="relative mt-6">
                <label class="block text-sm font-medium text-gray-700">Ciphertext:</label>
                <div class="flex items-center gap-2 mt-1">
                    <textarea id="ciphertext" rows="4" readonly class="block w-full rounded-lg border-2 border-gray-300 shadow-sm p-3 bg-white text-gray-800 output-textarea break-all"></textarea>
                    <button id="copyCiphertextBtn" onclick="copyToClipboard('ciphertext','copyCiphertextBtn')" class="py-3 px-4 rounded-lg shadow-lg text-sm font-bold text-white bg-blue-500 hover:bg-blue-600 transition-colors duration-200">Copy</button>
                </div>
            </div>
        </div>

        <!-- Decryption -->
        <div class="bg-gray-50 p-6 rounded-2xl shadow-inner border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">Decrypt</h2>
            <label class="block text-sm font-medium text-gray-700">Ciphertext:</label>
            <textarea id="ciphertext_input" rows="4" class="mt-1 block w-full rounded-lg border-2 border-gray-300 shadow-sm p-3 bg-white text-gray-800"></textarea>
            
            <div class="grid grid-cols-2 gap-4 mt-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">k:</label>
                    <input type="number" id="k_decrypt" class="mt-1 block w-full rounded-lg border-2 border-gray-300 shadow-sm p-3 bg-white text-gray-800">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">r:</label>
                    <input type="number" id="r_decrypt" class="mt-1 block w-full rounded-lg border-2 border-gray-300 shadow-sm p-3 bg-white text-gray-800">
                </div>
            </div>
            <button id="decryptBtn" onclick="decryptText()" class="w-full mt-6 py-3 px-4 rounded-lg shadow-lg text-sm font-bold text-white bg-blue-500 hover:bg-blue-600 transition-colors duration-200">Decrypt</button>
            
            <div class="relative mt-6">
                <label class="block text-sm font-medium text-gray-700">Decrypted Text:</label>
                <div class="flex items-center gap-2 mt-1">
                    <textarea id="decrypted_text" rows="4" readonly class="block w-full rounded-lg border-2 border-gray-300 shadow-sm p-3 bg-white text-gray-800 output-textarea break-all"></textarea>
                    <button id="copyDecryptedBtn" onclick="copyToClipboard('decrypted_text','copyDecryptedBtn')" class="py-3 px-4 rounded-lg shadow-lg text-sm font-bold text-white bg-blue-500 hover:bg-blue-600 transition-colors duration-200">Copy</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// --------------------
// Character sets
// --------------------
const CHAR_SET = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$&_ .,!?;:-'".split("");
const EMOJI_SET = ["üòÄ","üòÇ","üòç","üëç","üéâ","üî•","ü•∞","üòé","üò¢","ü§Ø","ü§î","üôå","üíØ","ü•≥","üòá","ü§©","ü§™","üòú","ü§ó"]; // extend as needed

// --------------------
// SHA-256 deterministic shuffle
// --------------------
async function sha256(str) {
    const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
    return Array.from(new Uint8Array(buf));
}
function bytesToFloat(bytes, idx) {
    let val = (bytes[idx]<<16 | bytes[idx+1]<<8 | bytes[idx+2]) & 0xFFFFFF;
    return val / 0xFFFFFF;
}
async function generate_Lf(k, r, set) {
    let char_coords = [];
    let seedStr = k + "," + r;
    let bytes = await sha256(seedStr);
    for(let i = 0; i < set.length; i++) {
        let ch = set[i];
        let x = bytesToFloat(bytes, (i * 3) % bytes.length);
        let y = bytesToFloat(bytes, (i * 3 + 1) % bytes.length);
        let z = bytesToFloat(bytes, (i * 3 + 2) % bytes.length);
        char_coords.push({ch: ch, coord: [x, y, z]});
    }
    char_coords.sort((a, b) => {
        if(a.coord[0] !== b.coord[0]) return a.coord[0] - b.coord[0];
        if(a.coord[1] !== b.coord[1]) return a.coord[1] - b.coord[1];
        return a.coord[2] - b.coord[2];
    });
    return char_coords.map(c => c.ch);
}

// --------------------
// Notification & Feedback functions
// --------------------
function showNotification(message, isError = false) {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = 'notification notification-show';
    if (isError) {
        notification.classList.add('notification-error');
    } else {
        notification.classList.remove('notification-error');
    }
    setTimeout(() => {
        notification.classList.remove('notification-show');
    }, 3000);
}

// --------------------
// Copy function
// --------------------
async function copyToClipboard(textareaId, buttonId) {
    const textarea = document.getElementById(textareaId);
    const button = document.getElementById(buttonId);
    
    let originalText = button.textContent;
    button.textContent = 'Copying...';
    button.disabled = true;

    try {
        await navigator.clipboard.writeText(textarea.value);
        button.textContent = 'Copied!';
    } catch (err) {
        // Fallback for browsers/environments where clipboard API is not available
        textarea.select();
        textarea.setSelectionRange(0, 99999);
        document.execCommand('copy');
        button.textContent = 'Copied!';
    } finally {
        setTimeout(() => {
            button.textContent = originalText;
            button.disabled = false;
        }, 2000);
    }
}

// --------------------
// Encryption
// --------------------
async function encryptText() {
    const plaintext = document.getElementById("plaintext").value;
    const k = parseInt(document.getElementById("k_encrypt").value);
    const r = parseInt(document.getElementById("r_encrypt").value);
    const encryptBtn = document.getElementById("encryptBtn");

    if (isNaN(k) || isNaN(r)) {
        showNotification("Please enter valid integers for k and r.", true);
        return;
    }
    if (!plaintext) {
        showNotification("Plaintext cannot be empty.", true);
        return;
    }

    encryptBtn.textContent = "Encrypting...";
    encryptBtn.disabled = true;

    try {
        const Lf_char = await generate_Lf(k, r, CHAR_SET);
        const Lf_emoji = await generate_Lf(k, r, EMOJI_SET);

        let cipher = "";
        for (const ch of plaintext) {
            if (CHAR_SET.includes(ch)) {
                let idx = CHAR_SET.indexOf(ch);
                cipher += Lf_char[idx];
            } else if (EMOJI_SET.includes(ch)) {
                let idx = EMOJI_SET.indexOf(ch);
                cipher += Lf_emoji[idx];
            } else {
                cipher += ch;
            }
        }
        document.getElementById("ciphertext").value = cipher;
    } catch (error) {
        console.error("Encryption failed:", error);
        showNotification("An error occurred during encryption.", true);
    } finally {
        encryptBtn.textContent = "Encrypt";
        encryptBtn.disabled = false;
    }
}

// --------------------
// Decryption
// --------------------
async function decryptText() {
    const ciphertext = document.getElementById("ciphertext_input").value;
    const k = parseInt(document.getElementById("k_decrypt").value);
    const r = parseInt(document.getElementById("r_decrypt").value);
    const decryptBtn = document.getElementById("decryptBtn");

    if (isNaN(k) || isNaN(r)) {
        showNotification("Please enter valid integers for k and r.", true);
        return;
    }
    if (!ciphertext) {
        showNotification("Ciphertext cannot be empty.", true);
        return;
    }

    decryptBtn.textContent = "Decrypting...";
    decryptBtn.disabled = true;

    try {
        const Lf_char = await generate_Lf(k, r, CHAR_SET);
        const Lf_emoji = await generate_Lf(k, r, EMOJI_SET);

        let plaintext = "";
        for (const ch of ciphertext) {
            if (Lf_char.includes(ch)) {
                let idx = Lf_char.indexOf(ch);
                plaintext += CHAR_SET[idx];
            } else if (Lf_emoji.includes(ch)) {
                let idx = Lf_emoji.indexOf(ch);
                plaintext += EMOJI_SET[idx];
            } else {
                plaintext += ch;
            }
        }
        document.getElementById("decrypted_text").value = plaintext;
    } catch (error) {
        console.error("Decryption failed:", error);
        showNotification("An error occurred during decryption.", true);
    } finally {
        decryptBtn.textContent = "Decrypt";
        decryptBtn.disabled = false;
    }
}
</script>

</body>
  </html>
                                                                                                                                                                                                                  
